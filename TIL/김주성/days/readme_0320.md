# Today I Learned(TIL)
## 날짜: 2023년 3월 20일 
## 한것
### 데이터 전처리
#### 칵테일 이미지 색상 분류
1. 색상 분류가 잘 되지 않은 사진 추출<br/>
12, 13, 16, 29, 28, 20, 40, 41, 42, 50, 52, 53, 60, 63, 64, 66, 79, 85, 89, 90, 91, 93, 95, 100, 102, 108, 109, 121, 124, 125, 126, 127, 128, 134, 136, 152, 154, 155, 165, 166, 169, 171, 172, 173, 174, 175, 177, 181, 194, 201, 206, 208, 210, 211, 212, 215, 217, 220, 225, 232, 235, 249, 250, 253, 265, 266, 270, 276, 282, 283, 287, 288, 289, 292, 296, 298, 307, 310, 311, 313, 324, 327, 328, 332, 335, 336, 337, 339, 340, 343, 349, 351, 356, 357, 360, 362, 365, 367, 369, 371, 373, 374, 382, 383, 386, 393, 396, 397, 400, 410, 411, 412, 414, 417, 423, 424, 426, 439, 446, 449, 450, 451, 452, 454, 455, 456, 457, 460, 463, 467, 470, 478, 480, 486, 487, 488, 494, 496, 500, 501, 502, 503, 505, 507, 508, 509, 513, 514, 515, 516, 525, 529, 532, 533, 536, 539, 541, 543, 551, 544, 556, 557, 569, 573, 578, 581, 582, 586, 592, 595, 598, 603, 606, 612, 613, 619, 620, 622, 623, 624, 626, 627, 629, 630, 632, 633, 639, 645, 655, 658, 659, 661, 663, 664, 667, 670, 671, 673, 674, 675, 678, 680, 683, 684, 694, 696, 703, 706, 716, 718, 720, 721, 730, 732, 735, 739, 741, 747, 754, 756, 757, 759, 763, 766, 769, 778, 781, 786, 787, 793, 795, 798, 799, 803, 808, 811, 814, 815, 816, 821, 822, 826, 830, 831, 836, 837, 840, 841, 842, 846, 847, 852, 853, 854, 857, 864, 868, 873, 878, 879, 907, 912, 917, 922, 924, 927, 930, 931, 933, 935, 938, 3675,3671,3660,3634,3462,3449,3362,3353,3265,2984,2909,2632,1302,1255,1145,1150,1126,1110,1114,1108,1106,1104,1097,1092,1087,1090,1086,1084,1082,1073,1069,1064,1058,1046,1040,1037,1036,1035,1029,1028,1017,1019,1010,1006,1007,1000,999,998,995,992,991,987,985,984,978,977,974,973,972,966,956,955,951,950,948,947,945938,935,933,931,930,928,924,922,917,908

2. 3676개의 사진을 5개의 종류로 나누어서 사진 배경 제거
- 사진마다 크기가 달라서 배경 제거에 사용하는 사각형 크기를 다르게 해야한다.
- 첫번째 구역: 범위: 0 ~ 1128, 사각형: (100, 150, 300, 300) := (시작점 x, 시작점 y, x의 길이, y의 길이)
- 두번째 구역의 사각형: 범위: 1129 ~ 1360, rectangle = (50, 0, 150, 250)
- 세번째 구역의 사각형: 범위: 1361 ~ 2997, rectangle = (10, 10, 130, 200)
- 네번째 구역의 사각형: 범위: 2998 ~ 3658 ,rectangle = (200, 100, 400, 600)
- 다섯번째 구역의 사각형:범위: 3658 ~ 3675, rectangle = (50, 25, 150, 180)

3. 색상 분류중 배경이 제거 되지 않은 데이터 추출<br/>
411, 1097, 1746, 2930, 2931, 2932, 2933, 2976, 2980, 2991

4. 1번과 3번에서 추출된 칵테일 데이터는 제외 예정


### AOuth 로그인 구현
#### 가입한 회원 정보 DB에 저장
카카오 로그인으로 로그인 시 이름, 이메일, 프로필사진, 성별, 연령대, 삭제여부, 생성일, 수정일 정보를 DB에 저장

#### JWT 설계 및 구현
##### JWT 설계
일반적인 상황에서는 토큰 또는 세선의 탈취가 어렵겠지만 해커는 다양한 방법으로 세션을 탈취할수 있다.
이를 위해서 XSS(Cross Site Scripting), CSRF(Cross-Site Request Forgery) 공격을 대비하기 위한 설계를 해야한다.
- 저장소별 XSS, CSRF 공격에 대한 내용

|구분|Local Storage|Session Storage|Cookie|스크립트 내 변수|
|:-:|:-:|:-:|:-:|:-:|
|자바스크립트 접근|가능|가능|가능|가능|
|HTTP 요청 시 자동 전송|미전송|미전송|전송|미전송|
|XSS 공격 가능|가능|가능|Http Only 옵션 설정 하면 불가능|불가능|
|CSRF 공격 가능|불가능|불가능|가능|불가능|
|데이터 삭제|자동 삭제 안됨 <br/> 개발자가 명시적으로 코드상에서삭제해야 함|브라우저 종료 시 자동 삭제|지정된 만료 시간이 되면 자동 삭제됨<br/> Session Cookie는 브라우저 종료시 자동 삭제<br/> Persistent Cookie는 브라우저 종료되어도 자동삭제 안됨<br/>|페이지 리로드 또는 페이지 이동 시 삭제<br/> 브라우저 종료 시 삭제|

-  Access Token, Refresh Token 저장 방법

|요구사항|Access Token|Refresh Token|
|:-:|:-:|:-:|
|XSS 공격 노출 가능|노출되면 안됨|노출되면 안됨|
|CSRF 공격 노출 가능|노출되면 안됨|노출되면 안됨<br/> (Refresh Token은 인증용 토큰이 아님)|
|데이터 유지|적당히 유지되면 됨|사용자가 로그아웃 하기전에는 정해진 시간 내에 브라우저에서 삭제 되면 안됨|
|적합한 저장소|자바스크립크 내 변수<br/> * 쿠키나 Storage가 아니기 때문에 외부 스크립트에서 사용불가, XSS 방어<br/> * 쿠키가 아니기 때문에 해커에 의한 자동 요청 전송 시에도 CSRF 방어 가능|Http Only, Session, Secure 설정된 쿠키<br/>  * Http Only로 하면 스크립트에서 사용 불가<br/>  * Session 으로 하면 브라우저 종료시 자동 삭제<br/>  * Secure로 설정해서 http 프로토콜에서는 해당 쿠키가 전송되지 않고, https에서만 전송되도록|

##### JWT 구현
- 스프링 부트에서 Refresh Token을 Http Only, Session, Secure 설정된 쿠키로 전송
- 스프링 부트에서 Access Token을 ResponseEntity로 전송


